/**
 * HÄ±zlÄ± BaÄŸÄ±ÅŸ Sistemi - Furkan Kampanya Sitesi
 * Instagram'dan gelen ziyaretÃ§iler iÃ§in optimize edilmiÅŸ IBAN kopyalama sistemi
 */

// HÄ±zlÄ± baÄŸÄ±ÅŸ modal'Ä±nÄ± aÃ§ma
function quickDonate() {
    const modal = document.getElementById('quickDonateModal');
    if (modal) {
        modal.classList.add('show');
        modal.style.display = 'flex';
        
        // Body scroll'u engelle
        document.body.style.overflow = 'hidden';
        
        // Analytics tracking
        if (typeof gtag !== 'undefined') {
            gtag('event', 'quick_donate_modal_opened', {
                'event_category': 'donation',
                'event_label': 'sticky_button'
            });
        }
    }
}

// Modal'Ä± kapatma
function closeQuickDonate() {
    const modal = document.getElementById('quickDonateModal');
    if (modal) {
        modal.classList.remove('show');
        modal.style.display = 'none';
        
        // Body scroll'u geri aÃ§
        document.body.style.overflow = 'auto';
    }
}

// HÄ±zlÄ± IBAN kopyalama (TL IBAN)
async function copyQuickIban() {
    const ibanText = document.getElementById('quickIbanText');
    const copyBtn = document.querySelector('.copy-iban-btn');
    
    if (!ibanText || !copyBtn) return;
    
    try {
        // IBAN'Ä± kopyala
        await navigator.clipboard.writeText(ibanText.textContent);
        
        // Buton animasyonu
        copyBtn.classList.add('copied');
        const originalText = copyBtn.querySelector('span').textContent;
        copyBtn.querySelector('span').textContent = 'KopyalandÄ±! ðŸ’š';
        
        // 3 saniye sonra eski haline dÃ¶ndÃ¼r
        setTimeout(() => {
            copyBtn.classList.remove('copied');
            copyBtn.querySelector('span').textContent = originalText;
        }, 3000);
        
        // BaÅŸarÄ± mesajÄ± gÃ¶ster
        showSuccessMessage();
        
        // Analytics tracking
        if (typeof gtag !== 'undefined') {
            gtag('event', 'iban_copied', {
                'event_category': 'donation',
                'event_label': 'tl_iban_quick_modal'
            });
        }
        
        // Modal'Ä± 2 saniye sonra kapat
        setTimeout(() => {
            closeQuickDonate();
        }, 2000);
        
    } catch (err) {
        console.error('IBAN kopyalama hatasÄ±:', err);
        showErrorMessage();
    }
}

// BaÅŸarÄ± mesajÄ± gÃ¶sterme
function showSuccessMessage() {
    // Mevcut mesajÄ± kaldÄ±r
    const existingMessage = document.querySelector('.donation-success-toast');
    if (existingMessage) {
        existingMessage.remove();
    }
    
    // Yeni baÅŸarÄ± mesajÄ± oluÅŸtur
    const successToast = document.createElement('div');
    successToast.className = 'donation-success-toast';
    successToast.innerHTML = `
        <div class="success-content">
            <i class="fas fa-check-circle"></i>
            <div class="success-text">
                <strong>IBAN KopyalandÄ±! ðŸ’š</strong>
                <span>BaÄŸÄ±ÅŸÄ±nÄ±z Furkan'Ä±n hayatÄ±nÄ± deÄŸiÅŸtirecek</span>
            </div>
            <button class="share-success" onclick="shareDonation()">
                <i class="fas fa-share-alt"></i>
            </button>
        </div>
    `;
    
    // Toast stilleri
    Object.assign(successToast.style, {
        position: 'fixed',
        top: '20px',
        right: '20px',
        background: 'linear-gradient(135deg, #48bb78 0%, #68d391 100%)',
        color: 'white',
        padding: '16px 20px',
        borderRadius: '12px',
        boxShadow: '0 8px 25px rgba(72, 187, 120, 0.3)',
        zIndex: '10001',
        transform: 'translateX(100%)',
        transition: 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)',
        maxWidth: '350px',
        cursor: 'pointer'
    });
    
    document.body.appendChild(successToast);
    
    // Animasyon
    setTimeout(() => {
        successToast.style.transform = 'translateX(0)';
    }, 100);
    
    // Otomatik kaldÄ±rma
    setTimeout(() => {
        successToast.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (successToast.parentNode) {
                successToast.parentNode.removeChild(successToast);
            }
        }, 400);
    }, 5000);
    
    // TÄ±klama ile kaldÄ±rma
    successToast.addEventListener('click', () => {
        successToast.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (successToast.parentNode) {
                successToast.parentNode.removeChild(successToast);
            }
        }, 400);
    });
}

// Hata mesajÄ± gÃ¶sterme
function showErrorMessage() {
    const errorToast = document.createElement('div');
    errorToast.className = 'donation-error-toast';
    errorToast.innerHTML = `
        <i class="fas fa-exclamation-triangle"></i>
        <span>IBAN kopyalanamadÄ±. LÃ¼tfen manuel olarak kopyalayÄ±n.</span>
    `;
    
    Object.assign(errorToast.style, {
        position: 'fixed',
        top: '20px',
        right: '20px',
        background: '#f56565',
        color: 'white',
        padding: '12px 16px',
        borderRadius: '8px',
        boxShadow: '0 4px 12px rgba(245, 101, 101, 0.3)',
        zIndex: '10001',
        transform: 'translateX(100%)',
        transition: 'transform 0.3s ease',
        maxWidth: '300px'
    });
    
    document.body.appendChild(errorToast);
    
    setTimeout(() => {
        errorToast.style.transform = 'translateX(0)';
    }, 100);
    
    setTimeout(() => {
        errorToast.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (errorToast.parentNode) {
                errorToast.parentNode.removeChild(errorToast);
            }
        }, 300);
    }, 4000);
}

// DiÄŸer seÃ§enekler - TÃ¼m IBAN'larÄ± gÃ¶ster
function showAllIbans() {
    closeQuickDonate();
    
    // IBAN bÃ¶lÃ¼mÃ¼ne scroll yap
    const ibanSection = document.getElementById('bankInfo');
    if (ibanSection) {
        ibanSection.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
        });
        
        // Accordion'u aÃ§ (varsa)
        const accordion = ibanSection.closest('.donation-section');
        if (accordion) {
            // Accordion aÃ§ma animasyonu
            setTimeout(() => {
                accordion.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    accordion.style.transform = 'scale(1)';
                }, 200);
            }, 500);
        }
    }
    
    // Analytics
    if (typeof gtag !== 'undefined') {
        gtag('event', 'view_all_ibans', {
            'event_category': 'donation',
            'event_label': 'quick_modal'
        });
    }
}

// Kredi kartÄ± seÃ§eneÄŸi
function openCreditCard() {
    closeQuickDonate();
    
    // Kredi kartÄ± bÃ¶lÃ¼mÃ¼ne scroll yap
    const creditCardSection = document.querySelector('.credit-card-box');
    if (creditCardSection) {
        creditCardSection.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
        });
        
        // Shopier linkine tÄ±kla
        setTimeout(() => {
            const shopierLink = document.querySelector('.credit-card-button');
            if (shopierLink) {
                shopierLink.click();
            }
        }, 800);
    }
    
    // Analytics
    if (typeof gtag !== 'undefined') {
        gtag('event', 'credit_card_donation', {
            'event_category': 'donation',
            'event_label': 'quick_modal'
        });
    }
}

// BaÄŸÄ±ÅŸ paylaÅŸÄ±mÄ±
function shareDonation() {
    const shareText = "Furkan'a umut oldum! Sen de destek olmak ister misin? ðŸ’™";
    const shareUrl = window.location.href;
    
    if (navigator.share) {
        // Web Share API (mobil)
        navigator.share({
            title: "Furkan Ä°Ã§in Umut",
            text: shareText,
            url: shareUrl
        }).then(() => {
            console.log('PaylaÅŸÄ±m baÅŸarÄ±lÄ±');
        }).catch((error) => {
            console.log('PaylaÅŸÄ±m hatasÄ±:', error);
            fallbackShare(shareText, shareUrl);
        });
    } else {
        // Fallback paylaÅŸÄ±m
        fallbackShare(shareText, shareUrl);
    }
    
    // Analytics
    if (typeof gtag !== 'undefined') {
        gtag('event', 'donation_shared', {
            'event_category': 'social',
            'event_label': 'success_toast'
        });
    }
}

// Fallback paylaÅŸÄ±m seÃ§enekleri
function fallbackShare(text, url) {
    const shareModal = document.createElement('div');
    shareModal.className = 'share-modal';
    shareModal.innerHTML = `
        <div class="share-modal-content">
            <h4>PaylaÅŸ</h4>
            <div class="share-options">
                <button onclick="shareToWhatsApp('${text}', '${url}')" class="share-btn whatsapp">
                    <i class="fab fa-whatsapp"></i>
                    WhatsApp
                </button>
                <button onclick="shareToTwitter('${text}', '${url}')" class="share-btn twitter">
                    <i class="fab fa-twitter"></i>
                    Twitter
                </button>
                <button onclick="shareToFacebook('${url}')" class="share-btn facebook">
                    <i class="fab fa-facebook"></i>
                    Facebook
                </button>
                <button onclick="copyShareLink('${text}', '${url}')" class="share-btn copy">
                    <i class="fas fa-link"></i>
                    Link Kopyala
                </button>
            </div>
            <button onclick="closeShareModal()" class="close-share">Kapat</button>
        </div>
    `;
    
    // Modal stilleri
    Object.assign(shareModal.style, {
        position: 'fixed',
        top: '0',
        left: '0',
        width: '100%',
        height: '100%',
        background: 'rgba(0, 0, 0, 0.8)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        zIndex: '10002',
        padding: '20px'
    });
    
    document.body.appendChild(shareModal);
    
    // Global kapatma fonksiyonu
    window.closeShareModal = () => {
        shareModal.remove();
    };
}

// WhatsApp paylaÅŸÄ±mÄ±
function shareToWhatsApp(text, url) {
    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`;
    window.open(whatsappUrl, '_blank');
    closeShareModal();
}

// Twitter paylaÅŸÄ±mÄ±
function shareToTwitter(text, url) {
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
    window.open(twitterUrl, '_blank');
    closeShareModal();
}

// Facebook paylaÅŸÄ±mÄ±
function shareToFacebook(url) {
    const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
    window.open(facebookUrl, '_blank');
    closeShareModal();
}

// Link kopyalama
async function copyShareLink(text, url) {
    try {
        await navigator.clipboard.writeText(`${text} ${url}`);
        
        // BaÅŸarÄ± mesajÄ±
        const successMsg = document.createElement('div');
        successMsg.textContent = 'Link kopyalandÄ±!';
        successMsg.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #48bb78;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 10003;
        `;
        
        document.body.appendChild(successMsg);
        
        setTimeout(() => {
            successMsg.remove();
            closeShareModal();
        }, 2000);
        
    } catch (err) {
        console.error('Link kopyalama hatasÄ±:', err);
        closeShareModal();
    }
}

// Modal dÄ±ÅŸÄ±na tÄ±klayÄ±nca kapatma
document.addEventListener('click', function(e) {
    const modal = document.getElementById('quickDonateModal');
    if (modal && e.target === modal) {
        closeQuickDonate();
    }
});

// ESC tuÅŸu ile kapatma
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeQuickDonate();
    }
});

// Sayfa yÃ¼klendiÄŸinde sticky buton gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ kontrol et
document.addEventListener('DOMContentLoaded', function() {
    // Ä°lk 3 saniye sonra sticky buton gÃ¶ster
    setTimeout(() => {
        const stickyBtn = document.querySelector('.quick-donate-sticky');
        if (stickyBtn) {
            stickyBtn.style.opacity = '1';
            stickyBtn.style.transform = 'translateY(-50%) translateX(0)';
        }
    }, 3000);
    
    // Scroll ile sticky buton animasyonu
    let lastScrollTop = 0;
    window.addEventListener('scroll', function() {
        const stickyBtn = document.querySelector('.quick-donate-sticky');
        if (!stickyBtn) return;
        
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        if (scrollTop > lastScrollTop && scrollTop > 200) {
            // AÅŸaÄŸÄ± scroll - butonu gizle
            stickyBtn.style.transform = 'translateY(-50%) translateX(-100px)';
        } else {
            // YukarÄ± scroll - butonu gÃ¶ster
            stickyBtn.style.transform = 'translateY(-50%) translateX(0)';
        }
        
        lastScrollTop = scrollTop;
    });
});

// Performance optimizasyonu: Intersection Observer ile lazy loading
if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                // Element gÃ¶rÃ¼nÃ¼r olduÄŸunda animasyonu baÅŸlat
                entry.target.style.animationPlayState = 'running';
            }
        });
    });
    
    // GÃ¶zlemlenecek elementleri ekle
    document.addEventListener('DOMContentLoaded', () => {
        const animatedElements = document.querySelectorAll('.quick-donate-btn, .modal-content');
        animatedElements.forEach(el => observer.observe(el));
    });
}
